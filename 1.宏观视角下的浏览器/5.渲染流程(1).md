## 渲染流程(上)

### 构建 dom 树

构建 DOM 树的输入内容是一个非常简单的 HTML 文件，然后经由 HTML 解析器解析，最终输出树状结构的 DOM。

### 样式计算

1. 当渲染引擎接收到 CSS 文本时，会执行一个转换操作，将 CSS 文本转换为浏览器可以理解的结构——styleSheets。
2. 转换样式表中的属性值，使其标准化
3. 计算出 DOM 树中每个节点的具体样式（继承规则和层叠规则）

### 布局阶段

#### 1.创建布局树

DOM 树中包含了很多不可见的元素，要额外构建一棵只包含可见元素的布局树

- 遍历 DOM 树中的所有可见节点，并把这些节点加入到布局树中
- 忽略不可见的节点，如 head 标签，display: none

#### 2.布局计算

计算布局树节点的坐标位置，把布局运算的结果重新协会到布局树中

### 思考题

#### 如果下载的 CSS 文件阻塞了，会阻塞 DOM 树的合成吗，会阻塞页面的显示吗

- 当从服务器接收 HTML 页面的第一批数据时，DOM 解析器就开始工作了，在解析过程中，如果遇到了 JS 脚本，那么 DOM 解析器会先执行 JavaScript 脚本，执行完成之后，再继续往下解析。

- 内联的脚本替换成 js 外部文件，这种情况下，当解析到 JavaScript 的时候，会先暂停 DOM 解析，并下载 js 文件，下载完成之后执行该段 JS 文件，然后再继续往下解析 DOM。这就是 JavaScript 文件为什么会阻塞 DOM 渲染。

- 当在 JavaScript 中访问了某个元素的样式，那么这时候就需要等待这个样式被下载完成才能继续往下执行，所以在这种情况下，CSS 也会阻塞 DOM 的解析。

所以 JS 和 CSS 都有可能会阻塞 DOM 解析
